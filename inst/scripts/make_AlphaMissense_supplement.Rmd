---
title: "make_AlphaMissense_supplement"
author: "Tram Nguyen"
date: "2024-07-12"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 80)
```

# Data information

Data from ProteinGym datasets was curated and processed by (19) to assess predictors on
predicting variant effects on protein fitness. The substitution benchmark consists of ~1.5M
variants from 87 MAVE experiments measured with 72 proteins. Data was accessed from
https://marks.hms.harvard.edu/tranception/ProteinGym_substitutions.zip (accessed 2023-01-13).
We provide the list of variants and our predictions as Supplementary Data S8.

Additional MAVE datasets
To generate an additional independent MAVE benchmark data set, we searched across MaveDB
(Esposito et al., 2019), MaveRegistry (Da Kuang et al., 2021), PubMed and BioRxiv. Studies
were selected for inclusion if they were (1) not originally in ProteinGym; (2) covered a human
protein; (3) measured a phenotype relevant to protein abundance/trafficking, protein-protein
interaction, enzymatic activity, or function; (4) had more than 100 variant measurements. MAVE
data was typically reported as a table available for download from the publication or data
repository. The exception was PPARG_HUMAN, for which we queried the webserver
accompanying the paper (https://miter.broadinstitute.org/) by searching through all possible
missense mutations at prevalence 1e-5. This was performed by changing the [ID] field in this
URL: https://miter.broadinstitute.org/mitergrade/?query=p.[ID]&prevalence=1.0e-5. Data
sources for these additional MAVE datasets are listed in Table S5.


# Download processed data

The original .csv table is available for download through the [AlphaMissense
Supplementary Data](https://www.science.org/doi/suppl/10.1126/science.adg7492/suppl_file/science.adg7492_data_s1_to_s9.zip).

Additional cell metadata, TSNE and PCA coordinates were provided 
courtesy of the authors.

---
title: "Load_ProteinGym"
author: "Tram Nguyen"
date: "2024-02-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ProteinGym information

More info: https://github.com/OATML-Markslab/ProteinGym

ProteinGym is a collection of benchmarks aiming at comparing the ability of
models to predict the effects of protein mutations. The benchmarks in ProteinGym
are divided according to mutation type (substitutions vs. indels), ground truth
source (DMS assay - Deep Mutational Scanning (DMS) assays - vs. clinical
annotation), and training regime (zero-shot vs. supervised).

Both the DMS assays and clinical variants are divided into 1) a substitution
benchmark which currently consists of the experimental characterisation of ~2.7M
missense variants across 217 DMS assays and 2,525 clinical proteins, and 2) an
indel benchmark that includes âˆ¼300k mutants across 74 DMS assays and 1,555
clinical proteins.

Each processed file in each benchmark corresponds to a single DMS assay or
clinical protein, and contains the following variables:

**mutant (str):** describes the set of substitutions to apply on the reference
sequence to obtain the mutated sequence (eg., A1P:D2N implies the amino acid 'A'
at position 1 should be replaced by 'P', and 'D' at position 2 should be
replaced by 'N'). Present in the the ProteinGym substitution benchmark only (not
indels). 

**mutated_sequence (str):** represents the full amino acid sequence for the
mutated protein. 

**DMS_score (float):** corresponds to the experimental measurement
in the DMS assay. Across all assays, the higher the DMS_score value, the higher
the fitness of the mutated protein. This column is not present in the clinical
files, since they are classified as benign/pathogenic, and do not have
continuous scores DMS_score_bin 

  - Higher DMS_score = more pathogenic. Affects fitness more.

**(int):** indicates whether the DMS_score is above
the fitness cutoff (1 is fit (pathogenic for clinical variants), 0 is not fit
(benign for clinical variants))

  - Binary based on cutoff whether impacts fitness or not.

Additionally, we provide two reference files for each benchmark that give
further details on each assay and contain in particular.


# Load in all ProteinGym data

```{r}
# Downloaded manually from ProteinGym website 
# https://proteingym.org/download
# Data stored locally
MAVE.dir <- "~/ProteinGym/DMS_ProteinGym_substitutions/"

ProGym_files <- list.files(path=MAVE.dir, full.names=F)

# Grab MAVE study names. These should match AlphaMissense.
ProGym_names <- sub(".csv", "", ProGym_files) 

# Load in all the files as tables in a list
ProGym_tables <- lapply(paste0(MAVE.dir, ProGym_files), read.csv)

# Assign respective MAVE study names to each list element
names(ProGym_tables) <- ProGym_names 

# Combine all of the dataframes together with each df name as a new column.
all_ProGym <- bind_rows(ProGym_tables, .id = "DMS_id")

# Put back in list form
all_ProGym <- split(all_ProGym, all_ProGym$DMS_id)
```

# Check ProteinGym data

ProteinGym consists of 87 studies across 72 proteins (1.5 million variants) - 26
of which cover human proteins. Check that this is accurate.

```{r}
# Grab the protein names (first and second substring of each element in list)
# If protein has two names, will be in the second substring. Else, the species
lst <- strsplit(sub('(^[^_]+_[^_]+)_(.*)$', '\\1 \\2', ProGym_names), ' ')

proteins <- sapply(lst,"[[",1)

# Collapse same proteins

cat("Confirmed", length(unique(proteins)), "unique proteins in ProteinGym data.")
```

Count how many human studies.

```{r}
indx <- paste("HUMAN")
human_studies <- ProGym_names[grep(indx, ProGym_names)]

# Count unique human proteins
lst_human <- strsplit(human_studies, split = "_", fixed = TRUE)

proteins_human <- sapply(lst_human,"[[",1)

cat("Confirmed", length(unique(proteins_human)), "unique human proteins.")
```

# Write MAVE list RDS

```{r, eval=FALSE}
# saveRDS(all_ProGym, paste0(MAVE.dir, "all_ProGym.RDS"))
```

# SessionInfo
```{r}
sessionInfo()
```

