---
title: "Importation and visualization of ProteinGym DMS data"
author: 
    - name: Tram Nguyen
      affiliation: Core for Computational Biomedicine, Harvard Medical School
      email: Tram_Nguyen@hms.harvard.edu
    - name: Pascal Notin
      affiliation: Computer Science, University of Oxford
    - name: Aaron W Kollasch
      affiliation: Systems Biology, Harvard Medical School
    - name: Ludwig Geistlinger
      affiliation: Core for Computational Biomedicine, Harvard Medical School
package: ProteinGymR
output:
    BiocStyle::html_document:
      self_contained: yes 
      toc: true
      toc_float: true
      toc_depth: 2
      code_folding: show
date: "`r doc_date()`"
vignette: >
    %\VignetteIndexEntry{Accessing ProteinGymR Data}
    %\VignetteEncoding{UTF-8}
    %\VignetteEngine{knitr::rmarkdown}
editor_options: 
    markdown: 
      wrap: 80
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
    collapse = TRUE,
    comment = "#>",
    crop = NULL
)
```

# Installation

Install the package using Bioconductor. Start R and enter:

```{r, eval = FALSE}
if(!requireNamespace("BiocManager", quietly = TRUE))
        install.packages("BiocManager")
BiocManager::install("ProteinGymR")
```

# Setup

Now, load the package and dependencies used in the vignette.

```{r, message = FALSE}
library(ProteinGymR)
library(tidyr)
library(dplyr)
library(stringr)
library(ggplot2)
```

# Introduction

Predicting the effects of mutations in proteins is critical to many
applications, from understanding genetic disease to designing novel proteins
to address our most pressing challenges in climate, agriculture and
healthcare. Despite an increase in machine learning-based protein modeling
methods, assessing the effectiveness of these models is problematic due to
the use of distinct, often contrived, experimental datasets and variable
performance across different protein families.

ProteinGym v1.0 is a large-scale and holistic set of benchmarks specifically
designed for protein fitness prediction and design. It encompasses both a
broad collection of over 250 standardized deep mutational scanning assays,
spanning millions of mutated sequences, as well as curated clinical datasets
providing high-quality expert annotations about mutation effects.
Furthermore, ProteinGym reports the performance of a diverse set of over 40
high-performing models from various subfields (eg., mutation effects,
inverse folding) into a unified benchmark.

# Data

The `ProteinGymR` package provides analysis-ready from and related to 
ProteinGym (Notin et. al.,
[2023](https://papers.nips.cc/paper_files/paper/2023/hash/cac723e5ff29f65e3fcbb0739ae91bee-Abstract-Datasets_and_Benchmarks.html)).
The these datasets can be access by querying ExperimentHub with the package
name.

1.  Deep mutational scanning assay (DMS) scores from 216 assays measuring
the impact of all possible amino acid substitutions across 186 proteins.

2.  AlphaMissense pathogenicity scores for ~1.6 M substitutions in the
ProteinGym DMS data.


# Load the DMS data from ExperimentHub

```{r import dms}
dms_data <- dms_substitutions()
```

Grab the DMS study names for the first 6 assays.
```{r view studies}
head(names(dms_data))
```

View an example of one DMS assay.
```{r view assay}
head(dms_data[[1]])
```

# Exploration and visualization

Explore an assay and create a heatmap of the DMS scores.
```{r ACE2, warning=FALSE, fig.wide = TRUE}
ACE2 <- dms_data[["ACE2_HUMAN_Chan_2020"]]

# Grab the reference amino acid
ACE2 <- 
    ACE2 |>
    dplyr::mutate(
        ref = str_sub(ACE2$mutant, 1, 1),
        pos = as.integer(
            gsub(".*?([0-9]+).*", "\\1", ACE2$mutant)
            ),
        alt = str_sub(ACE2$mutant, -1)
    )

# Create the heatmap
ACE2 |> ggplot(aes(x = pos, y = alt, fill = DMS_score)) +
    geom_tile() +
    scale_fill_gradient2(low = "blue", 
        mid = "white", 
        high = "red", 
        midpoint = 0,
        na.value = "grey") +
    theme_minimal() +
    xlim(20, 60) +
    xlab("Position") + ylab("Mutant residue") +
    labs(title = paste0("UniProt ID: ", unique(ACE2$UniProt_id))) +
    theme(
            axis.text.x = element_text(size = 16),
            axis.text.y = element_text(size = 16),
            axis.title.y = element_text(size = 16, vjust = 2),
            axis.title.x = element_text(size = 16, vjust = 0),
            legend.title = element_text(size = 16),
            legend.text = element_text(size = 16)
        )

```

```{r ADRB2, warning=FALSE, fig.wide = TRUE}
ADRB2 <- dms_data[["ADRB2_HUMAN_Jones_2020"]]

# Grab the reference amino acid
ADRB2 <- 
    ADRB2 |>
    dplyr::mutate(
        ref = str_sub(ADRB2$mutant, 1, 1),
        pos = as.integer(
            gsub(".*?([0-9]+).*", "\\1", ADRB2$mutant)
            ),
        alt = str_sub(ADRB2$mutant, -1)
    )

# Create the heatmap
ADRB2 |> ggplot(aes(x = pos, y = alt, fill = DMS_score)) +
    geom_tile() +
    scale_fill_gradient2(low = "blue", 
        mid = "white", 
        high = "red", 
        midpoint = 0,
        na.value = "grey") +
    theme_minimal() +
    xlim(0, 50) +
    xlab("Position") + ylab("Mutant residue") +
    labs(title = paste0("UniProt ID: ", unique(ADRB2$UniProt_id))) +
    theme(
            axis.text.x = element_text(size = 16),
            axis.text.y = element_text(size = 16),
            axis.title.y = element_text(size = 16, vjust = 2),
            axis.title.x = element_text(size = 16, vjust = 0),
            legend.title = element_text(size = 16),
            legend.text = element_text(size = 16)
        )
    
```


# Reference

Notin, P., Kollasch, A., Ritter, D., van Niekerk, L., Paul, S., Spinner, H., 
Rollins, N., Shaw, A., Orenbuch, R., Weitzman, R., Frazer, J., Dias, M., 
Franceschi, D., Gal, Y., & Marks, D. (2023). ProteinGym: Large-Scale 
Benchmarks for Protein Fitness Prediction and Design. In A. Oh, T. Neumann, 
A. Globerson, K. Saenko, M. Hardt, & S. Levine (Eds.), Advances in Neural 
Information Processing Systems (Vol. 36, pp. 64331-64379). 
Curran Associates, Inc.

# Session Info

```{r, sesh info}
sessionInfo()
```
